# Troubleshooting Log

## 2026-02-18
1. **`apply_patch` command missing** — running `apply_patch` failed with `/bin/bash: apply_patch: command not found`. Resolution: used a short Python script to edit the file instead of `apply_patch`. Logged this action so future agents know the command is unavailable in this shell.
2. **`patch` command reported `Only garbage was found in the patch input`** — the inline patch data was not accepted because the hunk headers did not match the existing file context. Resolution: swapped to a Python-driven replacement that inserted the desired block exactly at the known marker.
3. **`patch` command still failing when replacing the loop block** — the file had been modified earlier, causing `patch` to fail. Resolution: replaced the section programmatically with the intended new content via a Python rewrite.
4. **`arduino-cli compile` fails after installing dependencies** — missing `WiFiClient` declaration and private `DrawContext` getters due to the vendor's `AudioFileSourceVoiceTextStream` and `M5Stack-Avatar` versions. Resolution: wrapped VoiceText sources in `#ifdef USE_VOICE_TEXT`, guarded the WiFi-dependent headers, and refactored the Ataru/Ram face helpers onto the public `DrawContext` getters, which eliminated the `private`-member errors. The compile/upload now finishes cleanly, so this blocker is resolved.
5. **`control_stackchan.py` timed out waiting for ACK** — the CLI command never got the `OK/ERR` reply because the serial port was being held in reset: forcing `ser.dtr = False` after opening kept the ESP32 in reset, so the parser never ran. Resolution: stop forcing DTR low, flush the input buffer, and wait a few seconds after opening before sending the first command. The script now receives `OK`, so the RPC path is healthy again.
